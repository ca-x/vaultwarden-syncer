<div class="login-header">
    <h1>{{call .T "auth.login.title"}}</h1>
    <p>{{call .T "auth.login.subtitle"}}</p>
</div>

<form hx-post="/api/login" hx-target="#result" hx-swap="innerHTML">
    <div class="form-group">
        <label for="username">{{call .T "auth.username"}}</label>
        <input type="text" id="username" name="username" placeholder="{{call .T "auth.username"}}" required>
    </div>
    
    <div class="form-group password-group">
        <label for="password">{{call .T "auth.password"}}</label>
        <div class="password-input-container">
            <input type="password" id="password" name="password" class="password-input" placeholder="{{call .T "auth.password"}}" required>
            <button type="button" class="password-toggle" onclick="togglePassword('password')">
                {{icon "password-show"}}
                {{icon "password-hide"}}
            </button>
        </div>
    </div>
    
    <button type="submit" class="btn btn-primary btn-full">{{call .T "auth.login.button"}}</button>
    <div id="result" class="result" style="display: none;"></div>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    const result = document.getElementById('result');
    
    // Handle form submission
    form.addEventListener('htmx:after-request', function(event) {
        const xhr = event.detail.xhr;
        const status = xhr.status;
        
        if (status === 200) {
            // Success - redirect or show success message
            const response = xhr.responseText;
            if (response.includes('success') || response.includes('dashboard')) {
                result.innerHTML = '<div class="toast toast-success"><iconify-icon icon="mdi:check-circle"></iconify-icon>Login successful! Redirecting...</div>';
                result.style.display = 'block';
                // Redirect after a short delay
                setTimeout(function() {
                    window.location.href = '/dashboard';
                }, 1500);
            }
        } else {
            // Error
            result.innerHTML = '<div class="toast toast-error"><iconify-icon icon="mdi:alert-circle"></iconify-icon>Login failed. Please check your credentials.</div>';
            result.style.display = 'block';
        }
        
        // Auto-hide result after 5 seconds
        setTimeout(function() {
            result.style.opacity = '0';
            setTimeout(function() {
                result.style.display = 'none';
                result.style.opacity = '1';
                result.innerHTML = '';
            }, 300);
        }, 5000);
    });
    
    // Show loading state on form submission
    form.addEventListener('htmx:before-request', function() {
        const submitBtn = form.querySelector('button[type="submit"]');
        submitBtn.innerHTML = '<iconify-icon icon="mdi:loading" class="spinning"></iconify-icon>Logging in...';
        submitBtn.disabled = true;
    });
    
    // Reset button after request
    form.addEventListener('htmx:after-request', function() {
        const submitBtn = form.querySelector('button[type="submit"]');
        submitBtn.innerHTML = '{{call .T "auth.login.button"}}';
        submitBtn.disabled = false;
    });
    
    // Password visibility toggle
    window.togglePassword = function(inputId) {
        const input = document.getElementById(inputId);
        const container = input.closest('.password-input-container');
        const showIcon = container.querySelector('.password-show-icon');
        const hideIcon = container.querySelector('.password-hide-icon');
        
        if (input.type === 'password') {
            input.type = 'text';
            showIcon.style.display = 'none';
            hideIcon.style.display = 'block';
        } else {
            input.type = 'password';
            showIcon.style.display = 'block';
            hideIcon.style.display = 'none';
        }
    };
});
</script>